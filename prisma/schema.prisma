// This is your Prisma schema file for Supabase PostgreSQL
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model OrderLog {
  id                  String   @id @default(cuid())
  orderNumber         String   @map("order_number")
  status              String   @default("RECEIVED")
  rawPayload          Json     @map("raw_payload")
  customerReachedOut  Boolean  @default(false) @map("customer_reached_out")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@map("order_logs")
  @@index([createdAt])
  @@index([orderNumber])
  @@index([customerReachedOut])
}

// Packer batch = up to 24 orders. Admin sends bulk groups to queue as chunked BulkQueueItems.
model BulkQueueItem {
  id                 String   @id @default(cuid())
  batchId            String?  @unique @map("batch_id") // Human-readable: "Bulk-000123" (6 digits = 1M capacity, numbers only)
  bulkGroupSignature String   @map("bulk_group_signature")
  chunkIndex         Int      @map("chunk_index")
  totalChunks        Int      @map("total_chunks")
  orderNumbers       Json     @map("order_numbers") // string[] - order numbers in this chunk (max 24)
  packageInfo        Json     @map("package_info") // { carrier, service, packaging, weight, dimensions }
  status             String   @default("PENDING")   // PENDING | COMPLETED
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@map("bulk_queue_items")
  @@index([status])
}

// Key-value app settings (order highlight rules, future settings).
model AppSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("app_settings")
}



